close all, clear all, clc, format compact

% number of samples of each cluster
K = 100;
% offset of clusters
q = .6;
% define 2 groups of input data
A = [3.36036528194700,1.40784683371375,2.18183384536350,2.21965368598162,2.41129354229504,2.04083023224644,0.719337693584962,2.44758302704000,1.69866931289258,2.81774208850706,2.36471664740193,3.16042035309693,2.66439477390155,2.10816747775899,4.12157217106180,0.875855797299111,1.16565828491044,1.05176817460446,2.46037805047940,2.68639771980234,2.82056711883036,1.08804597538981,1.84652397094146,2.93484116428984,2.16184561962430,1.46202833571516,1.73041319455744,2.98653107112180,-0.861608891853873,2.01159108947413,4.17579156971481,2.22854174268066,1.74327189428945,1.24105027176832,3.39590790913010,0.742089519321137,2.08923264401530,2.45389386208311,1.64781386266500,1.44425613554292,3.18854668370437,1.03540039626387,3.28069557958254,1.49340316499865,3.18273610206040,2.48207736850777,1.14805833115701,1.48238482911852,-0.335369785874124,2.13361863537095,0.875397123896517,1.10402687943281,2.02510830445489,2.50186306767364,4.96192842447204,1.94264516625682,0.829322858801667,1.00320766524436,3.33655543960863,3.53156720999664,1.49309951822681,-0.275182394115917,2.43144929113732,2.03056145795338,3.55704928899567,2.09969155755254,1.02197472754738,1.56575093940759,2.36443154473706,3.36786632387187,1.87078224681078,0.132764777764954,3.08616414969591,0.793043840318759,2.90168574603356,0.572685767554051,2.84733966613121,2.18504509044985,1.35666617994679,-0.217570901040249,2.53732181353231,1.53349576771100,2.12457137521340,2.24219007551915,1.83072417401497,2.42636992120408,0.102824820760550,1.24443172508922,0.889144663874518,0.604287609194030,1.48153806581090,0.355961841270429,0.174668687445029,0.476990654458372,3.98771387125761,3.57825513552804,3.98264348826140,3.13476798369286,2.09755923236943,1.82816603878725,1.40412428743968,1.17991886033149,1.64064268530066,-0.334311949066239,1.95055057193486,1.94854551196991,-0.249499113620937,2.30566039680483,3.86915189460820,3.29812222173117,0.719209580219646,2.09199980284459,0.518630858815713,-0.291673301825171,1.43241528583086,1.52374346517859,2.42248642607927,3.65071588095717,1.96285223768097,2.70322883745114,0.737880893845506,3.61828091541140,1.12220371389046,2.56905544129418,3.13332222800851,3.19757939301037,2.03325080946556,1.85037343737445,1.75890036994833,0.412858859772918,2.17527211055864,2.22194192993934,1.99502447325251,2.32564335932905,1.62920328845280,3.13165527989817,1.12383785861025,1.19931534229884,2.97206173904976,2.14555736661556,2.20101634101805,1.71534006202261,2.40434755482436,1.92153683005789,1.87266469896800,1.22536644057928,3.02423999460630,3.21872826406058,3.47066297112196,4.01106780583703
    -2.09250161204631,-2.52655630625271,-2.59552182776880,-4.06078628036214,-1.03506512840649,-4.26427217891695,-3.43076026328803,-2.01981301945207,-4.71403983668620,-5.43811383819202,-2.05119484661436,-4.49294321072860,-4.47414996494640,-3.77737692633229,-3.10150122145504,-4.05758362264844,-2.16443947490064,-3.41783482159418,-2.28508134994301,-3.67442653528671,-0.609029159145580,-2.85645115148707,-3.35731465511846,-2.63911423186702,-2.58308811690726,-3.50421300627001,-1.67969323900770,-2.67294395183970,-3.31843255889808,-4.00533225738970,-4.01650326985746,-3.84360598227127,-3.75625857565419,-1.16722971043062,-5.28789751235607,-2.38391567639170,-2.25144976821794,-4.25262899749035,-2.65004582014192,-2.33772936936491,-2.14584563843991,-3.34805685846956,-3.80512066634697,-2.02171948495556,-2.26473580086957,-2.22599160179455,-1.24663215851000,-3.07258976793640,-3.77888737354826,-2.81605152141114,-2.34828795594920,-0.590129295596423,-4.90391996758206,-5.29678888692343,-3.93249062647466,-4.31960203998820,-2.34951029979953,-3.14666823281286,-2.75842786483246,-2.29743312527431,-3.58238022956452,-3.10745192299453,-2.57298831868414,-3.23033257858197,-5.65041368431170,-1.17006853952632,-3.26659790839366,-4.78412186469630,-3.70697044604931,-2.56509731545010,-2.44513279207900,-3.20708985306770,-2.79834500186412,-4.58940852859106,-4.41152233471332,-3.18277382746508,-2.29488301573699,-2.46890283326816,-2.58022848101540,-3.56026464678392,-4.31255516417701,-0.931342587984834,-2.44486903417154,-3.58978015333705,-2.71461377363383,-1.54200320536656,-3.57427672885452,-2.80453862858018,-1.07192767632397,-4.13774617462936,-5.12952312239716,-4.00815587184363,-1.79718556713042,-4.07030078138665,-2.40075339856162,-2.32993810645769,-3.17518815186017,-1.70514187421936,-3.72820761058222,-4.40316910546063,-2.97868463643967,-3.79932526983695,-2.19543698212250,-2.91393882970192,-3.33568921288389,-3.62370151365416,-5.52102460451206,-2.45797275385774,-2.80421372517999,-5.05821678360641,-0.826938184180225,-2.73732348976689,-3.45566249572187,-4.68338271168382,-3.75320067711860,-3.67818876700965,-1.85998125782506,-2.44309369822064,-3.39396144500718,-2.54133340280098,-4.80007649066226,-2.61176736388818,-2.58265402658417,-3.37486309804662,-4.68869776419668,-3.39908068578740,-2.21780558382204,-1.35176281553186,-2.01327619066934,-0.973968446143348,-3.09487600746561,-2.61658177264234,-5.09930505596804,-5.58788320140903,-2.65450976210466,-3.35893116531810,-5.23405848395943,-4.91207044457732,-3.33937388998490,-1.59927516560931,-4.25552739606957,-3.20777164226009,-1.15182936632250,-1.96725741641710,-3.66028437611429,-3.57094903744019,-2.96318944603410,-3.15575610682206,-2.77309110335557,-3.72204242196738];
B = [2.36580535729758,1.12937245289089,3.28672787023629,0.319606047058949,2.81838025352052,3.44118926039303,1.30092812648717,0.866465393972144,2.16204229441339,0.695250857661312,2.63477529954565,0.885885428216367,2.11579374237901,0.499090932640520,0.902531153978132,1.95837494893420,1.58883317538829,2.99025300760572,1.24183420479025,2.10758943287707,0.613278179466996,1.47208021660140,2.62342041309912,2.52798883927999,1.29240057791951,1.65448826329783,2.10090236940853,3.53723699944968,2.43967767188950,0.705178379193605,0.152577751354553,3.24004513912293,1.74403980539874,2.79100891938597,1.60549519391392,2.98089408988659,2.75003229412834,2.09528777413175,2.13226618707029,0.437597897202151,2.67942520929089,3.98355028579979,3.50014414691373,2.44578859960974,1.51908170089739,1.79337077638575,2.51790106935850,1.74500046336042,1.72005821684138,0.678802246981318,2.59512298019587,2.61698101105690,0.755203237705674,1.99050437262079,3.80575127961601,2.45681341801811,2.28790135169759,1.51784132277954,1.49312321816754,2.23217967175013,1.49763546892828,3.16567525105903,2.54867376281682,1.91736198334744,1.94556874130225,1.21196862697287,1.97019645205315,1.99338444233984,0.0437205062227819,2.60624989356615,2.13425286555983,0.883615355533260,1.51442977053805,0.483653779643404,2.49400637779679,2.90527190205719,1.05119003712317,3.01222698918648,1.83065443108879,2.46385203191855,2.90461277151627,2.23025267560903,2.30501030019339,1.28925661169133,4.77442917338685,0.383785281277378,1.97614692940405,2.54329363134746,0.103185311667604,4.41305003161100,1.96481782375167,1.23301044395825,1.01674496547766,0.0609904723105832,2.82229825055249,1.73784729646935,2.77549924133203,1.82087984665302,3.20690166670807,1.78588262571492
    0.758638526164166,2.38622437782532,1.41587145711599,0.573766744261237,1.21057327630122,4.46160977416077,4.33206415257672,2.18966770590114,0.0395228989324590,2.65029790014976,1.77376413091147,2.92587794750807,2.28681576623071,1.24785147146509,3.09664291099666,3.75052993803253,1.36716885339118,1.56863234355918,3.26179620866700,-0.182254514278871,1.05615130808166,0.651565117197504,0.739777480631099,1.49696043776876,0.517278188968198,0.336835507540547,1.80408801628954,1.76685926453453,0.636328709747158,1.37338126458694,3.41578729422709,1.68398098304455,3.03804844550016,2.54114045194423,2.46390868242570,1.96869938071191,2.36484121311701,2.79492427151737,3.49029078569816,3.20542382283830,1.61556479058972,1.37405748895481,2.83329269403467,1.61281394326921,1.82016587232332,4.24301716347969,2.43507519471729,1.28014078199158,2.56760651375271,2.29254070823415,1.02942967452137,2.44155726264488,3.69621668037575,2.52248061922109,3.22084714305220,1.96780986038139,2.28826705928375,1.76338068970643,1.03420408354333,1.65839947360163,2.40583162656817,0.558952507432722,2.93786587201582,4.28470497009913,2.98070983050305,2.46317632101881,2.02758774885966,1.77159289780749,3.52697395451554,-1.03750792305080,1.27629849644723,1.60236602816365,4.16470813582843,0.409343304326426,2.10930967784267,2.52037335935956,1.76890454837292,1.79544191366400,2.84336069654769,2.43721418426912,2.53740518941183,1.20157106862086,0.763983558576643,0.913614141389667,1.92629686805805,0.794326123320067,3.11664391718189,1.85256038031848,0.615183342146057,1.14967736586367,1.79380567566456,1.59745008596574,-0.663120346474735,0.365238211176183,0.902035972267609,3.45272067679897,2.33221395421346,1.42526622856307,3.48411485732288,3.66100846609744];

% plot data
plot(A(1,:),A(2,:),'k+',B(1,:),B(2,:),'b*')
grid on
hold on
% coding (+1/-1) for 2-class XOR problem
a = -1;
b =  1;
P = [A B];
% define targets
T = [repmat(a,1,length(A)) repmat(b,1,length(B))];
% NEWRB algorithm
% The following steps are repeated until the network's mean squared error
% falls below goal:
%  1. The network is simulated
%  2. The input vector with the greatest error is found
%  3. A radbas neuron is added with weights equal to that vector
%  4. The purelin layer weights are redesigned to minimize error

% choose a spread constant
spread = 2;
% choose max number of neurons
K      = 150;
% performance goal (SSE)
goal   = 0;
% number of neurons to add between displays
Ki     = 4;
% create a neural network
net    = newrb(P,T,goal,spread,K,Ki);

% view network
view(net)
% simulate RBFN on training data
Y = net(P);

% calculate [%] of correct classifications
correct = 100 * length(find(T.*Y > 0)) / length(T);
fprintf('\nSpread          = %.2f\n',spread)
fprintf('Num of neurons  = %d\n',net.layers{1}.size)
fprintf('Correct class   = %.2f %%\n',correct)

% plot targets and network response
figure;
plot(T')
hold on
grid on
plot(Y','r')
ylim([-2 2])
set(gca,'ytick',[-2 0 2])
legend('Targets','Network response')
xlabel('Sample No.')

% generate a grid
span    = 	-8:.025:8;
[P1,P2] = meshgrid(span,span);
pp      = [P1(:) P2(:)]';
% simualte neural network on a grid
aa      = sim(net,pp);

% plot classification regions based on MAX activation
figure(1)
ma = mesh(P1,P2,reshape(-aa,length(span),length(span))-5);
mb = mesh(P1,P2,reshape( aa,length(span),length(span))-5);
set(ma,'facecolor',[1 0.2 .7],'linestyle','none');
set(mb,'facecolor',[1 1.0 .5],'linestyle','none');
view(2)
plot(net.iw{1}(:,1),net.iw{1}(:,2),'gs')